<view class="gao-page scan-page">
  <page-bg />
  <ar-tracker
    disable-scroll
    id="ar-tracker-main-frame"
    width="{{renderWidth}}"
    height="{{renderHeight}}"
    style="width:100vw;height:100vh;"
    bind:arTrackerReady="handleSceneReady"
    bind:arAssetsLoaded="handleArAssetsLoaded"
    bind:catchAsset="handleCatchAsset"
  />
  <block wx:if="{{sceneReady}}">
    <view class="ar-nav-bar-wrap">
      <nav-bar text="{{navTitle}}" divider-color="transparent" />
    </view>
    <view wx:if="{{!arAssetsLoaded}}" class="scan-page-loading">
      <mp-loading show type="circle" tips="AR资源正在加载中..."></mp-loading>
    </view>
    <view wx:elif="{{!catchAsset}}" class="scan-frame-wrap">
      <image src="/assets/gao/scan-frame.png" mode="aspectFit" />
      <view class="tips">请保持平稳对准扫描，自动识别中</view>
    </view>
    <view class="ar-recorder-wrap">
      <ar-recorder
        id="ar-scan-recorder"
        type="all"
        holding
        bind:tap="handleRecord"
        bind:longpress="handleRecordStart"
        bind:touchend="handleRecordStop"
        bind:recordStarted="recordStarted"
        bind:recordFinished="recordFinished"
      />
    </view>
    <mp-half-screen-dialog 
      show="{{showShareVideoDialog}}"
      closabled="{{false}}"
      maskClosable="{{false}}" 
    >
      <view slot="title">分享视频</view>
      <view slot="desc">点击分享按钮将刚刚拍摄的视频发送给好友吧！</view>
      <view slot="footer">
        <button type="default" class="weui-btn" bind:tap="hideShareVideoDialog">取消</button>
        <button type="primary" class="weui-btn" bind:tap="shareVideoToMessage">分享</button>
      </view>
    </mp-half-screen-dialog>
    <view wx:if="{{showPoster}}" class="poster-mask" >
      <view class="poster-content">
        <image class="share-pic" src="{{posterPath}}" mode="heightFix"/>
        <view class="share-btn-group" >
          <view class="share-btn" bind:tap="handleMaskTappedPoster">返回</view>
          <view class="share-btn" catch:tap="handleShare">去分享</view>
        </view>
      </view>
    </view>
  </block>
  <view wx:else class="scan-page-loading">
    <mp-loading show type="circle" tips="环境准备中..."></mp-loading>
  </view>
</view>