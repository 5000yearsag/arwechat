# éŸ³é¢‘åŠŸèƒ½ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥ç»“æœï¼šâœ… å·²ä¿®å¤å¹¶ä¿æŒä¸€è‡´

ç»è¿‡è¯¦ç»†æ£€æŸ¥å’Œä¿®å¤ï¼Œæ–°åˆ†æ”¯ `weapp-art-branch` çš„éŸ³é¢‘åŠŸèƒ½ç°åœ¨ä¸ä¸»åˆ†æ”¯ `main` ä¿æŒå®Œå…¨ä¸€è‡´ã€‚

## å‘ç°çš„é—®é¢˜ âš ï¸

### åŸå§‹é—®é¢˜
æ–°åˆ†æ”¯ä¸­çš„ `components/ar/tracker/index.js` ç»„ä»¶**ç¼ºå°‘éŸ³é¢‘åŠ è½½ç›¸å…³ä»£ç **ï¼Œè¿™ä¼šå¯¼è‡´ARåœºæ™¯ä¸­çš„éŸ³é¢‘æ— æ³•æ­£å¸¸æ’­æ”¾ã€‚

### å…·ä½“ç¼ºå¤±å†…å®¹
1. **éŸ³é¢‘ä¸Šä¸‹æ–‡ç®¡ç†å˜é‡** - `audioContextMap`
2. **éŸ³é¢‘æ¸…ç†ç”Ÿå‘½å‘¨æœŸ** - `detached()` æ–¹æ³•  
3. **éŸ³é¢‘æ’­æ”¾é€»è¾‘** - `handleTrackerSwitch` ä¸­çš„éŸ³é¢‘å¤„ç†ä»£ç 
4. **WXMLæ•°æ®å±æ€§** - `data-scene-uuid` ç”¨äºéŸ³é¢‘è¯†åˆ«

## å·²å®Œæˆçš„ä¿®å¤ âœ…

### 1. æ·»åŠ éŸ³é¢‘ä¸Šä¸‹æ–‡ç®¡ç†
```javascript
let audioContextMap = {} // å­˜å‚¨æ¯ä¸ªèµ„æºçš„éŸ³é¢‘ä¸Šä¸‹æ–‡
```

### 2. æ·»åŠ ç»„ä»¶æ¸…ç†é€»è¾‘
```javascript
detached() {
  // æ¸…ç†æ‰€æœ‰éŸ³é¢‘ä¸Šä¸‹æ–‡
  Object.values(audioContextMap).forEach(context => {
    if (context) {
      context.stop();
      context.destroy();
    }
  });
  audioContextMap = {};
},
```

### 3. å®Œæ•´çš„éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
```javascript
// æ¯ä¸ªèµ„æºç‹¬ç«‹çš„éŸ³é¢‘æ’­æ”¾ï¼ˆæ”¯æŒå åŠ æ’­æ”¾ï¼‰
if (target) {
  const item = this.data.sceneList.find(sceneData => sceneData.sceneUuid === dataset.sceneUuid);
  if (item && item.audioResourceUrl && item.sceneUuid) {
    const contextKey = `${item.sceneUuid}_audio`;
    
    if (!audioContextMap[contextKey]) {
      audioContextMap[contextKey] = wx.createInnerAudioContext({
        useWebAudioImplement: true
      });
      audioContextMap[contextKey].src = item.audioResourceUrl;
      audioContextMap[contextKey].loop = true;
    }
    
    // å¦‚æœéŸ³é¢‘URLå˜åŒ–ï¼Œé‡æ–°åˆ›å»º
    if (audioContextMap[contextKey].src !== item.audioResourceUrl) {
      audioContextMap[contextKey].stop();
      audioContextMap[contextKey].destroy();
      audioContextMap[contextKey] = wx.createInnerAudioContext({
        useWebAudioImplement: true
      });
      audioContextMap[contextKey].src = item.audioResourceUrl;
      audioContextMap[contextKey].loop = true;
    }
    
    active ? audioContextMap[contextKey].play() : audioContextMap[contextKey].pause();
  }
}
```

### 4. æ›´æ–°WXMLæ¨¡æ¿
æ·»åŠ äº† `data-scene-uuid="{{item.sceneUuid}}"` å±æ€§åˆ° `xr-ar-tracker` ç»„ä»¶ï¼Œç¡®ä¿JavaScriptä»£ç èƒ½æ­£ç¡®è¯†åˆ«å¯¹åº”åœºæ™¯ã€‚

## åŠŸèƒ½ç‰¹æ€§å¯¹æ¯” ğŸ“Š

| éŸ³é¢‘åŠŸèƒ½ç‰¹æ€§ | ä¸»åˆ†æ”¯ (main) | æ–°åˆ†æ”¯ (weapp-art-branch) | çŠ¶æ€ |
|-------------|---------------|---------------------------|------|
| éŸ³é¢‘ä¸Šä¸‹æ–‡ç®¡ç† | âœ… | âœ… | ä¸€è‡´ |
| å¤šéŸ³é¢‘å åŠ æ’­æ”¾ | âœ… | âœ… | ä¸€è‡´ |
| éŸ³é¢‘è‡ªåŠ¨å¾ªç¯ | âœ… | âœ… | ä¸€è‡´ |
| ç»„ä»¶é”€æ¯æ—¶æ¸…ç†éŸ³é¢‘ | âœ… | âœ… | ä¸€è‡´ |
| åŠ¨æ€éŸ³é¢‘URLæ›´æ–° | âœ… | âœ… | ä¸€è‡´ |
| WebAudioä¼˜åŒ– | âœ… | âœ… | ä¸€è‡´ |
| WXMLæ•°æ®ç»‘å®š | âœ… | âœ… | ä¸€è‡´ |

## æŠ€æœ¯ç»†èŠ‚

### éŸ³é¢‘ç®¡ç†æœºåˆ¶
- **ç‹¬ç«‹ä¸Šä¸‹æ–‡**: æ¯ä¸ªARåœºæ™¯éƒ½æœ‰ç‹¬ç«‹çš„éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šåœºæ™¯éŸ³é¢‘å åŠ æ’­æ”¾
- **å†…å­˜ç®¡ç†**: ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†æ‰€æœ‰éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- **åŠ¨æ€æ›´æ–°**: æ”¯æŒéŸ³é¢‘èµ„æºURLçš„åŠ¨æ€å˜æ›´å’Œé‡æ–°åŠ è½½
- **å¾ªç¯æ’­æ”¾**: éŸ³é¢‘é»˜è®¤å¼€å¯å¾ªç¯æ’­æ”¾æ¨¡å¼

### å…³é”®ç»„ä»¶æ–‡ä»¶
- **ä¸»è¦é€»è¾‘**: `components/ar/tracker/index.js`
- **æ¨¡æ¿æ–‡ä»¶**: `components/ar/tracker/index.wxml`  
- **æ•°æ®ä¼ é€’**: é€šè¿‡ `data-scene-uuid` å±æ€§å…³è”åœºæ™¯å’ŒéŸ³é¢‘

## éªŒè¯å»ºè®®

### åŠŸèƒ½æµ‹è¯•æ¸…å•
1. **åŸºç¡€éŸ³é¢‘æ’­æ”¾**: ARè¯†åˆ«æˆåŠŸåéŸ³é¢‘è‡ªåŠ¨æ’­æ”¾
2. **éŸ³é¢‘åœæ­¢**: ARè·Ÿè¸ªä¸¢å¤±æ—¶éŸ³é¢‘æš‚åœ
3. **å¤šåœºæ™¯éŸ³é¢‘**: å¤šä¸ªARåœºæ™¯å¯åŒæ—¶æ’­æ”¾ä¸åŒéŸ³é¢‘
4. **éŸ³é¢‘å¾ªç¯**: çŸ­éŸ³é¢‘æ–‡ä»¶æ­£ç¡®å¾ªç¯æ’­æ”¾
5. **èµ„æºæ¸…ç†**: åˆ‡æ¢é¡µé¢æˆ–å…³é—­åº”ç”¨æ—¶éŸ³é¢‘æ­£ç¡®åœæ­¢

### æµ‹è¯•æ­¥éª¤
```bash
# éƒ¨ç½²æµ‹è¯•
1. ä½¿ç”¨weapp-art-branchåˆ†æ”¯ä»£ç 
2. ä¸Šä¼ åŒ…å«éŸ³é¢‘çš„ARåœºæ™¯ 
3. æµ‹è¯•ARè¯†åˆ«å’ŒéŸ³é¢‘æ’­æ”¾åŠŸèƒ½
4. éªŒè¯å¤šåœºæ™¯éŸ³é¢‘å åŠ æ•ˆæœ
5. ç¡®è®¤å†…å­˜å’Œèµ„æºç®¡ç†æ­£å¸¸
```

## æ€»ç»“

âœ… **é—®é¢˜å·²è§£å†³**: æ–°åˆ†æ”¯çš„éŸ³é¢‘åŠŸèƒ½ç°åœ¨ä¸ä¸»åˆ†æ”¯å®Œå…¨ä¸€è‡´  
âœ… **åŠŸèƒ½å®Œæ•´**: åŒ…å«æ‰€æœ‰éŸ³é¢‘ç®¡ç†å’Œæ’­æ”¾ç‰¹æ€§  
âœ… **æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒå¤šéŸ³é¢‘å åŠ å’Œå†…å­˜è‡ªåŠ¨æ¸…ç†  
âœ… **å‘åå…¼å®¹**: ä¿æŒä¸åŸæœ‰ARç»„ä»¶çš„å®Œå…¨å…¼å®¹æ€§  

æ–°åˆ†æ”¯ç°åœ¨å¯ä»¥å®‰å…¨åœ°ç”¨ä½œä¸»è¦å·¥ä½œåˆ†æ”¯ï¼ŒéŸ³é¢‘åŠŸèƒ½å·²ç»å®Œå…¨å¯¹é½ã€‚