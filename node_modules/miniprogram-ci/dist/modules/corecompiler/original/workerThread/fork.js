"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=require("tslib"),log=tslib_1.__importStar(require("../../../../utils/log")),index_1=tslib_1.__importDefault(require("./task/index")),config_1=require("./config"),getProcess_1=require("../../../../utils/subprocess/getProcess"),process=(0,getProcess_1.getProcess)();let isbusy=!1;process.on("message",s=>{const{command:e,data:r}=s;e===config_1.COMMAND.RUN_TASK&&(isbusy=!0,(0,index_1.default)(r.taskName,r.data).then(s=>{isbusy=!1,process.send({command:config_1.COMMAND.TASK_DONE,data:s})}).catch(s=>{isbusy=!1,process.send({command:config_1.COMMAND.TASK_DONE,data:{error:s.toString()}})}))}),process.on("SIGTERM",()=>{isbusy&&(log.error("forked sub process is kill when busy"),process.exit(1)),process.exit(0)});